import{_ as e}from"./Black.b78a5e9b.js";import{_ as t}from"./input.22b40e50.js";import{d as s,j as o,D as a,k as l,o as n,p as i,q as r,s as p,e as c,u,b as d,w as x,a as f,f as m,t as _,F as h,l as v,m as g}from"./index-1ce5008d.js";import{_ as w}from"./button.bcf26005.js";import{_ as y}from"./toast.a93d2c92.js";import{f as j,g as k,h as b,i as T}from"./index.30070924.js";import{g as V,f as W}from"./index.243deaf5.js";import{u as B}from"./pinia-auto-refs.0a4d1dcc.js";import{_ as C}from"./_plugin-vue_export-helper.1b428a4d.js";import"./router.a71bc990.js";import"./urlMap.3d32d270.js";import"./icon.219c12b7.js";import"./transition.2d1cecda.js";import"./request.9efe9454.js";const I=C(s({__name:"login",setup(s){const{topHeight:C}=V(),{setUserInfo:I,setToken:U}=B("root"),q=o(),z=a({account:"",passWord:"",code:"",countdown:0,timer:null,type:!0}),D=o(!1);function F(){var e;""!==z.account&&11===z.account.length?z.countdown>0||(j({phoneNumber:z.account}).then((()=>{uni.showToast({title:"验证码已发送",icon:"success",duration:800})})).catch((e=>{console.log("err====",e)})),z.countdown=60,z.timer=setInterval((()=>{z.countdown-=1,z.countdown<=0&&clearInterval(z.timer)}),1e3)):null==(e=q.value)||e.showToast.fail("请填写完整的手机号码",{duration:800})}function H(){z.type=!z.type,z.passWord="",z.code=""}function M(){if(!D.value)if(D.value=!0,function(){var e;let t="";""!==z.account&&11===z.account.length||(t+="请填写完整的手机号码");z.type?""===z.passWord&&(t+=""!==t?",密码不能为空":"密码不能为空"):""===z.code&&(t+=""!==t?",验证码不能为空":"验证码不能为空");return""===t||(console.log(t),null==(e=q.value)||e.showToast.fail(t,{duration:1200}),!1)}()){(z.type?k:b)(z.type?{username:z.account,password:z.passWord}:{username:z.account,code:z.code}).then((e=>{console.log("res===",e.token),uni.setStorageSync("token",e.token),U(e.token),T().then((e=>{I({...e.user,permissions:e.permissions,roles:e.roles}),W("index"),D.value=!1})).catch((e=>{console.log("err====",e),D.value=!1}))})).catch((e=>{console.log("err====",e),D.value=!1}))}else setTimeout((()=>{var e;null==(e=q.value)||e.hideToast(),D.value=!1}),1e3)}function N(){uni.navigateTo({url:"/pages/forgotPassword/forgotPassword"})}return l((()=>{uni.hideTabBar({success:()=>{},fail:()=>{}})})),(s,o)=>{const a=e,l=v(g("nut-input"),t),j=v(g("nut-button"),w),k=v(g("nut-toast"),y);return n(),i(h,null,[r(" login-main loginBg h-48px flex justify-start items-center text-_wn_fff text-20px pt-15px px-20px pt-80px h-100_pes_ clearable _wn_left i-ri-user-line text-_wn_808080 i-ri-lock-line _wn_right i-ri-shield-check-line justify-between text-_wn_009729 text-14px pt-20px px-10px pt-40px "),p("div",{class:"login-main"},[p("div",{class:"loginBg"},[p("div",{style:c({paddingTop:`${u(C)}px`})},[p("div",{"h-48px":"",flex:"","justify-start":"","items-center":"",class:"h-48px flex justify-start items-center"},[d(a)]),p("div",{text:"#fff 20px","pt-15px":"",class:"text-_wn_fff text-20px pt-15px"},"智能物联房屋管理")],4)]),p("div",{"px-20px":"","pt-80px":"",class:"px-20px pt-80px"},[p("div",{h:"100%",class:"h-100_pes_"},[d(l,{modelValue:u(z).account,"onUpdate:modelValue":o[0]||(o[0]=e=>u(z).account=e),placeholder:"请输入手机号码","max-length":"11",clearable:"",class:"clearable"},{left:x((()=>[p("div",{"i-ri-user-line":"",text:"#808080",class:"i-ri-user-line text-_wn_808080"})])),_:1},8,["modelValue"]),u(z).type?(n(),f(l,{key:0,modelValue:u(z).passWord,"onUpdate:modelValue":o[1]||(o[1]=e=>u(z).passWord=e),placeholder:"请输入密码",type:"password",clearable:"",class:"clearable"},{left:x((()=>[p("div",{"i-ri-lock-line":"",text:"#808080",class:"i-ri-lock-line text-_wn_808080"})])),right:x((()=>[])),_:1},8,["modelValue"])):(n(),f(l,{key:1,modelValue:u(z).code,"onUpdate:modelValue":o[2]||(o[2]=e=>u(z).code=e),placeholder:"请输入验证码",clearable:"",class:"clearable"},{left:x((()=>[p("div",{"i-ri-shield-check-line":"",text:"#808080",class:"i-ri-shield-check-line text-_wn_808080"})])),right:x((()=>[d(j,{type:"primary",size:"small",onClick:F},{default:x((()=>[m(_(u(z).countdown>0?`${u(z).countdown}秒`:"获取验证码"),1)])),_:1})])),_:1},8,["modelValue"]))]),p("div",{flex:"","justify-between":"",text:"#009729 14px","pt-20px":"","px-10px":"",class:"flex justify-between text-_wn_009729 text-14px pt-20px px-10px"},[p("div",{onClick:H},_(u(z).type?"验正码登录":"密码登录"),1),u(z).type?(n(),i("div",{key:0,onClick:N},"忘记密码")):r("v-if",!0)]),p("div",{"pt-40px":"",class:"pt-40px"},[d(j,{loading:u(D),style:{width:"100%"},type:"primary",onClick:M},{default:x((()=>[m(" 登录 ")])),_:1},8,["loading"])]),d(k,{ref_key:"toastRef",ref:q},null,512)])])],2112)}}}),[["__scopeId","data-v-37776ef4"]]);export{I as default};
