import{V as e,W as r,X as s,Q as t,d as o,E as l,c as n,o as a,a as i,w as u,n as c,u as d,e as p,r as m,f,t as v,q as h,b as y,g as _,D as b,A as g,Y as A,Z as x}from"./index-7ef9e5b0.js";import{c as P,n as w,m as E,o as O,a as j,t as k,g as q,p as $,_ as I,P as T,B as C,D as S,i as L}from"./icon.4e54a3b5.js";import{a as M,F as V,f as W,b as B}from"./input.ea4d2faf.js";import{_ as D,a as F}from"./cellgroup.c0f39baa.js";import{_ as G}from"./_plugin-vue_export-helper.1b428a4d.js";function H(e,r,s){const t=function(e,r){const s=[],t=e=>{Array.isArray(e)&&e.forEach((e=>{var o;if((l=e)&&!0===l.__v_isVNode){var l;if(r){if(e.type&&e.type.name===r)return void s.push(e)}else s.push(e);(null==(o=e.component)?void 0:o.subTree)&&t(e.component.subTree.children),e.children&&t(e.children)}}))};return t(e),s}(e&&e.subTree&&e.subTree.children,s);r.sort(((e,r)=>t.indexOf(e.vnode)-t.indexOf(r.vnode)))}const N={...P,required:w,prop:E(""),label:E(""),rules:O([]),labelWidth:j(""),labelAlign:E("left"),bodyAlign:E("left"),errorMessageAlign:E("left"),showErrorLine:k,showErrorMessage:k,labelPosition:E(void 0),starPosition:E(void 0),isLink:Boolean},J=`${T}-form-item`,Q=o({name:J,inheritAttrs:!1,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),U=G(o({...Q,props:N,setup(e){var r;const s=e,t=l(),o=M(V),b=n((()=>{var e,r;if(!1===s.required)return!1;const t=null==(r=null==(e=o.parent)?void 0:e.props)?void 0:r.rules;let l=!1;for(const o in t)Object.prototype.hasOwnProperty.call(t,o)&&o===s.prop&&Array.isArray(t[o])&&(l=t[o].some((e=>e.required)));return s.required||s.rules.some((e=>e.required))||l})),g=n((()=>{var e;const r=null==(e=o.parent)?void 0:e.props.labelPosition;return`nut-form-item__${s.labelPosition?s.labelPosition:r}`})),A=n((()=>{var e;const r=null==(e=o.parent)?void 0:e.props.starPosition;return`nut-form-item__star-${s.starPosition?s.starPosition:r}`})),x=n((()=>q(s,J))),P=n((()=>({width:$(s.labelWidth),textAlign:s.labelAlign}))),w=n((()=>({textAlign:s.bodyAlign}))),E=(null==(r=o.parent)?void 0:r.formErrorTip)||{},O=n((()=>({textAlign:s.errorMessageAlign})));return(e,r)=>{const o=_;return a(),i(D,{"custom-class":[{error:d(E)[e.prop],line:e.showErrorLine},d(x),d(g)],"custom-style":e.customStyle},{default:u((()=>{return[e.label||(r="label",t[r])?(a(),i(o,{key:0,class:c(["nut-cell__title nut-form-item__label",{required:d(b),[d(A)]:d(A)}]),style:p(d(P))},{default:u((()=>[m(e.$slots,"label",{},(()=>[f(v(e.label),1)]),!0)])),_:3},8,["style","class"])):h("v-if",!0),y(o,{class:"nut-cell__value nut-form-item__body"},{default:u((()=>[y(o,{class:"nut-form-item__body__slots",style:p(d(w))},{default:u((()=>[m(e.$slots,"default",{},void 0,!0),s.isLink?(a(),i(I,{key:0,"custom-class":"nut-cell__link",name:"right"})):h("v-if",!0)])),_:3},8,["style"]),d(E)[e.prop]&&e.showErrorMessage?(a(),i(o,{key:0,class:"nut-form-item__body__tips",style:p(d(O))},{default:u((()=>[f(v(d(E)[e.prop]),1)])),_:1},8,["style"])):h("v-if",!0)])),_:3})];var r})),_:3},8,["custom-class","custom-style"])}}}),[["__scopeId","data-v-a5720eac"]]),X=`${T}-form`,Y=o({name:X,options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"}}),Z=G(o({...Y,props:W,emits:B,setup(o,{expose:l,emit:f}){const v=o;l({reset:function(){w()},submit:function(){return j(),!1},validate:j});const h=n((()=>b({}))),{internalChildren:_}=function(o,l){const n=e([]),a=e([]),i=t(),u=e=>{e.proxy&&(n.push(s(e)),a.push(s(e.proxy)),H(i,n,l))},c=e=>{e.proxy&&(n.splice(n.indexOf(s(e)),1),a.splice(a.indexOf(s(e.proxy)),1))};return e=>(r(o,{add:u,remove:c,internalChildren:n,...e}),{internalChildren:n,children:a})}(V,"nut-form-item")({props:v,formErrorTip:h}),P=n((()=>q(v,X)));function w(){Object.keys(h.value).forEach((e=>{h.value[e]=""}))}function E(e){let r=[];return e.forEach((e=>{var s,t,o,l;let n=e.type;n=n.name||n,"nut-form-item"===n||(null==n?void 0:n.toString().endsWith("form-item"))?r.push({prop:null==(s=e.props)?void 0:s.prop,rules:(null==(t=e.props)?void 0:t.rules)||[]}):Array.isArray(e.children)&&(null==(o=e.children)?void 0:o.length)?r=r.concat(E(e.children)):C(e.children)&&Object.keys(e.children)?(null==(l=e.children)?void 0:l.default)&&(e.children=e.children.default(),r=r.concat(E(e.children))):Array.isArray(e)&&(r=r.concat(E(e)))})),r}function O(e){e.message&&f("validate",e),h.value[e.prop]=e.message}function j(e=""){return new Promise(((r,s)=>{try{const s=E(null==_?void 0:_.map((e=>e.vnode))).map((r=>e&&e!==r.prop?Promise.resolve(!0):async function(e){const{rules:r,prop:s}=e,t=e=>new Promise(((r,s)=>{try{O(e),r(e)}catch(t){s(t)}}));s||console.warn("[NutUI] <FormItem> 使用 rules 校验规则时 , 必须设置 prop 参数");const o=S(v.modelValue,s||"");O({prop:s,message:""});const l=v.rules||{},n=[...(null==l?void 0:l[s])||[],...r];for(;n.length;){const e=n.shift(),{validator:r,...l}=e,{required:i,regex:u,message:c}=l,d={prop:s,message:c};if(i)if(Array.isArray(o)){if(!o.length)return t(d)}else if(!o&&0!==o)return t(d);if(u&&!u.test(String(o)))return t(d);if(r){const e=r(o,l);if(L(e))try{if(!1===await e)return t(d)}catch(a){return t({prop:s,message:a})}else if(!e)return t(d)}}return Promise.resolve(!0)}(r)));Promise.all(s).then((e=>{const s={valid:!0,errors:[]};(e=e.filter((e=>!0!==e))).length&&(s.valid=!1,s.errors=e),r(s)}))}catch(t){s(t)}}))}return g((()=>v.modelValue),(()=>{w()}),{immediate:!0}),(e,r)=>{const s=x;return a(),i(s,{class:c(d(P)),style:p(e.customStyle),action:"#",onSubmit:r[0]||(r[0]=A((()=>!1),["prevent"]))},{default:u((()=>[y(F,null,{default:u((()=>[m(e.$slots,"default",{},void 0,!0)])),_:3})])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-dea67cbb"]]);export{U as _,Z as a};
